# Development Notes

## Next Steps

1. **Find Game Directory**: Locate your Schedule I installation
   - Common Steam location: `/mnt/c/Program Files (x86)/Steam/steamapps/common/Schedule I/`
   - Or custom library: `/mnt/<drive>/SteamLibrary/steamapps/common/Schedule I/`
   - Find it: `find /mnt -name "Schedule I" -type d 2>/dev/null`

2. **Verify MelonLoader Installed**: Check if MelonLoader exists
   ```bash
   ls -la "<game_dir>/MelonLoader"
   ```
   If missing, install from: https://thunderstore.io/c/schedule-i/p/LavaGang/MelonLoader/

3. **Run Game Once**: Generate unhollowed assemblies
   - Launch Schedule I from Steam
   - Wait for MelonLoader console to show initialization complete
   - Close game

4. **Setup References**: Copy game assemblies to project
   ```bash
   ./scripts/setup-refs.sh "/path/to/Schedule I"
   ```

5. **Verify Namespaces**: Check game code structure
   - Install dnSpy: https://github.com/dnSpy/dnSpy/releases
   - Open: `<game_dir>/Schedule I_Data/Managed/Assembly-CSharp.dll` (requires Mono beta)
   - Find root namespace
   - Update `using` statements in src/ files if needed

6. **Build Project**: Compile both targets
   ```bash
   ./scripts/build.sh
   ```

7. **Deploy and Test**: Copy to game and verify
   ```bash
   ./scripts/deploy.sh "/path/to/Schedule I" il2cpp
   ```

## Important Files

- `src/ModMain.cs` - Entry point, modify OnInitializeMelon for startup logic
- `src/Patches/` - Harmony patches, examples show prefix/postfix patterns
- `scripts/setup-refs.sh` - Run this after cloning or game updates
- `libs/` - Not in git, generated by setup-refs.sh

## Common Commands

```bash
# Full workflow
./scripts/setup-refs.sh "/path/to/game"
./scripts/build.sh
./scripts/deploy.sh "/path/to/game" il2cpp

# Clean build
rm -rf build/
./scripts/build.sh

# View build output
ls -lah build/mono/
ls -lah build/il2cpp/

# Check game logs after testing
tail -f "/path/to/game/MelonLoader/Latest.log"
```

## Troubleshooting

### Build fails with "Assembly not found"
- Run `./scripts/setup-refs.sh` first
- Check `libs/mono/` and `libs/il2cpp/` contain DLLs

### "bad interpreter" error on scripts
- Line ending issue (should be LF, not CRLF)
- Fix: `dos2unix scripts/*.sh` or `sed -i 's/\r$//' scripts/*.sh`

### Mod doesn't load in game
- Check `MelonLoader/Latest.log` in game directory
- Verify DLL is in `<game>/Mods/` folder
- Check MelonInfo attribute matches game name exactly

### Wrong namespace errors when building
- Use dnSpy to verify actual game namespaces
- Update `using` statements in all .cs files
- Rebuild project
